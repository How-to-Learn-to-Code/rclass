<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HTLTC-R: Reading, writing, and regular expressions • htltcR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="HTLTC-R: Reading, writing, and regular expressions">
<meta property="og:description" content="htltcR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">htltcR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/control.html">HTLTC-R: Control statements</a>
    </li>
    <li>
      <a href="../articles/functions.html">HTLTC-R: Functions</a>
    </li>
    <li>
      <a href="../articles/graphics.html">HTLTC-R: Graphics</a>
    </li>
    <li>
      <a href="../articles/io.html">HTLTC-R: Reading, writing, and regular expressions</a>
    </li>
    <li>
      <a href="../articles/operators.html">HTLTC-R: Operators</a>
    </li>
    <li>
      <a href="../articles/package.html">HTLTC-R: Reproducible research &amp; packages</a>
    </li>
    <li>
      <a href="../articles/palettes.html">HTLTC-R: Color packages</a>
    </li>
    <li>
      <a href="../articles/plotting-ggplot.html">HTLTC-R: Plotting with ggplot2</a>
    </li>
    <li>
      <a href="../articles/plotting.html">HTLTC-R: Plotting</a>
    </li>
    <li>
      <a href="../articles/structures.html">HTLTC-R: Data structures &amp; subsetting</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>HTLTC-R: Reading, writing, and regular expressions</h1>
            
      
      
      <div class="hidden name"><code>io.Rmd</code></div>

    </div>

    
    
<div id="using-this-document" class="section level3">
<h3 class="hasAnchor">
<a href="#using-this-document" class="anchor"></a>Using this document</h3>
<ul>
<li>Code blocks and R code have a grey background (note, code nested in the text is not highlighted in the pdf version of this document but is a different font).</li>
<li># indicates a comment, and anything after a comment will not be evaluated in R</li>
<li>The comments beginning with ## under the code in the grey code boxes are the output from the code directly above; any comments added by us will start with a single #</li>
<li>While you can copy and paste code into R, you will learn faster if you type out the commands yourself.</li>
<li>Read through the document after class. This is meant to be a reference, and ideally, you should be able to understand every line of code. If there is something you do not understand please email us with questions or ask in the following class (you’re probably not the only one with the same question!).</li>
</ul>
</div>
<div id="goals" class="section level3">
<h3 class="hasAnchor">
<a href="#goals" class="anchor"></a>Goals</h3>
<ol style="list-style-type: decimal">
<li>Understand how to point to files, including best practices</li>
<li>Practice reading and writing files</li>
<li>Know how to import data from a csv file</li>
<li>Work on cleaning up a file for analysis</li>
</ol>
</div>
<div id="file-paths" class="section level3">
<h3 class="hasAnchor">
<a href="#file-paths" class="anchor"></a>File paths</h3>
<p>The first step when accessing a file – whether reading or writing – is correctly pointing to the file on the filesystem. To do so, you must specify the path. For an example of a path run the following:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>()
<span class="co">## [1] "/Users/runner/runners/2.169.1/work/rclass/rclass/vignettes"</span></pre></body></html></div>
<p>This stands for “get working directory.” Your working directory is very important – this is where R will look for files. The working directory will For example:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span>(<span class="st">"madeupfile.txt"</span>)
<span class="co">## [1] FALSE</span></pre></body></html></div>
<p>This function looks for a file called “madeupfile.txt” in the working directory, and returns <code>FALSE</code> indicating there is no such file. The working directory will depend on where <code>R</code> is called from. At any time you can change the working directory with the <code>setwd</code> function. However, R can easily look outside the current working directory by specifying a path. A typical path looks like the following:</p>
<pre><code>/path/to/some/folder/file.extension</code></pre>
<p>The problem is the exact formatting of paths differ from operating system to operating system. Rather than simply typing “/path/to/some/folder/file.extension” using the <code>file.path</code> function will make your code more portable (meaning it will play nice when running on other operating systems):</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="st">"/"</span>, <span class="st">"path"</span>, <span class="st">"to"</span>, <span class="st">"some"</span>, <span class="st">"folder"</span>, <span class="st">"file.extension"</span>)
<span class="co">## [1] "//path/to/some/folder/file.extension"</span></pre></body></html></div>
<p>Specifying paths creates problems for reproducible analysis. Generally speaking, you do not want your analysis to depend on the current working directory. You also do not want the analysis to depend on users having files in specific locations. Later in the course we will give you the skills to circumvent the issue by wrapping your analysis in a package. For now, just keep in mind no one will be able to run your analysis if the paths are specific to your computer! The best option is the package route, but another option is to create a variable that contains the path to the analysis directory.</p>
</div>
<div id="manipulating-the-file-system" class="section level3">
<h3 class="hasAnchor">
<a href="#manipulating-the-file-system" class="anchor"></a>Manipulating the file system</h3>
<p>To illustrate we will learn about a family of functions that manipulate the file system. Conveniently, they follow the format <code>file.*</code> or <code>dir.*</code> (“dir” is referencing a directory, or folder). We will use the file sytem functions to create a new directory containing subdirectories and files.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="co"># Step one is to specify the "analysis dir" -- ad -- here, we place the dir</span>
<span class="co"># in the temporary dir created by R. This isn't important. (This variable</span>
<span class="co"># is where someone recreating your analysis would specify the path)</span>
<span class="no">ad</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span>(), <span class="st">"myanalysis"</span>)
<span class="co"># First check for the directory -- you always want to check so that you</span>
<span class="co"># do not overwrite someone's files (there is also a file.exists)</span>
<span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.exists</a></span>(<span class="no">ad</span>)
<span class="co">## [1] FALSE</span>
<span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span>(<span class="no">ad</span>)
<span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="no">ad</span>, <span class="st">"sub"</span>))
<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.create</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="no">ad</span>, <span class="st">"f1.txt"</span>))
<span class="co">## [1] TRUE</span>
<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.create</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="no">ad</span>, <span class="st">"sub"</span>, <span class="st">"f2.txt"</span>))
<span class="co">## [1] TRUE</span>
<span class="co"># List the files in the given directory. recursive = TRUE indicates to </span>
<span class="co"># look in all subdirectories and list those files as well. You'll notice</span>
<span class="co"># the paths to the files in subdirectories specify the path from the given</span>
<span class="co"># path </span>
<span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span>(<span class="no">ad</span>, <span class="kw">recursive</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="co">## [1] "f1.txt"     "sub/f2.txt"</span></pre></body></html></div>
<p>Now imagine you have a folder containing all of the scripts and files for your analysis. You should write your scripts such that all of the file paths are rooted by a path to the analysis directory, such that someone else could change that one variable and run your code. There are many other functions for manipulating the file system – most of which we will not cover – but the following shows how to rename, move, and then delete files.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span>(<span class="kw">from</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="no">ad</span>, <span class="st">"f1.txt"</span>),
            <span class="kw">to</span>   <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="no">ad</span>, <span class="st">"f5.txt"</span>))
<span class="co">## [1] TRUE</span>
<span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span>(<span class="no">ad</span>, <span class="kw">recursive</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="co">## [1] "f5.txt"     "sub/f2.txt"</span>
<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.remove</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="no">ad</span>, <span class="st">"f5.txt"</span>))
<span class="co">## [1] TRUE</span>
<span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span>(<span class="no">ad</span>, <span class="kw">recursive</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="co">## [1] "sub/f2.txt"</span>
<span class="co"># Finally, remove the folder we created above (and all its contents!). </span>
<span class="co"># Careful here, this is a dangerous function. </span>
<span class="fu"><a href="https://rdrr.io/r/base/unlink.html">unlink</a></span>(<span class="no">ad</span>, <span class="kw">recursive</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<p>Manipulating the file system in R can be really helpful. Rather than manually renaming, moving, or deleting files you can have R do it for you. When you get into dealing with hundreds or thousands of files this becomes really helpful!</p>
</div>
<div id="reading-and-writing-text-files" class="section level3">
<h3 class="hasAnchor">
<a href="#reading-and-writing-text-files" class="anchor"></a>Reading and writing text files</h3>
<p>Before we talk about the higher level functions to read in data files, we will briefly discuss how R interacts with files. This topic is very detailed and is intended for illustration – you will not likely use these functions. The first step is to establish a connection to a file – file being generic here. We will only discuss simple text files, but the connection can be to a website, compressed file, etc. First, we will create a file and establish a connection.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">xmplFile</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span>(), <span class="st">"example.txt"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.create</a></span>(<span class="no">xmplFile</span>)
<span class="co">## [1] TRUE</span>
<span class="no">con1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/connections.html">file</a></span>(<span class="no">xmplFile</span>)
<span class="no">con1</span>
<span class="co">## A connection with                                                                                      </span>
<span class="co">## description "/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T//RtmpZNpg8q/example.txt"</span>
<span class="co">## class       "file"                                                                    </span>
<span class="co">## mode        "r"                                                                       </span>
<span class="co">## text        "text"                                                                    </span>
<span class="co">## opened      "closed"                                                                  </span>
<span class="co">## can read    "yes"                                                                     </span>
<span class="co">## can write   "yes"</span></pre></body></html></div>
<p>The connection is created, but not opened. We will now open the connection, read and write some lines, then close the connection and delete the file. When opening a connection you must specify to read, write, or append. Opening a file to write (or to read &amp; write) will delete all data in the file. To preserve the existing content you have to open as append (or read &amp; append). You can run <code><a href="https://rdrr.io/r/base/connections.html">?open</a></code> to read more about the different opening modes.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/connections.html">open</a></span>(<span class="no">con1</span>, <span class="kw">open</span> <span class="kw">=</span> <span class="st">"w+"</span>) <span class="co"># the mode 'w+' here means write and read</span>
<span class="fu"><a href="https://rdrr.io/r/base/readLines.html">readLines</a></span>(<span class="no">con1</span>)
<span class="co">## character(0)</span>
<span class="fu"><a href="https://rdrr.io/r/base/writeLines.html">writeLines</a></span>(<span class="kw">text</span> <span class="kw">=</span> <span class="st">"hello"</span>, <span class="kw">con</span> <span class="kw">=</span> <span class="no">con1</span>)
<span class="fu"><a href="https://rdrr.io/r/base/readLines.html">readLines</a></span>(<span class="no">con1</span>)
<span class="co">## [1] "hello"</span>
<span class="fu"><a href="https://rdrr.io/r/base/writeLines.html">writeLines</a></span>(<span class="kw">text</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"this"</span>, <span class="st">"is"</span>, <span class="st">"some"</span>, <span class="st">"more"</span>, <span class="st">"text"</span>), <span class="kw">con</span> <span class="kw">=</span> <span class="no">con1</span>)
<span class="fu"><a href="https://rdrr.io/r/base/readLines.html">readLines</a></span>(<span class="no">con1</span>)
<span class="co">## [1] "this" "is"   "some" "more" "text"</span>
<span class="fu"><a href="https://rdrr.io/r/base/connections.html">close</a></span>(<span class="no">con1</span>)
<span class="fu"><a href="https://rdrr.io/r/base/readLines.html">readLines</a></span>(<span class="no">xmplFile</span>)
<span class="co">## [1] "hello" "this"  "is"    "some"  "more"  "text"</span>
<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.remove</a></span>(<span class="no">xmplFile</span>)
<span class="co">## [1] TRUE</span></pre></body></html></div>
<p>Lastly, notice two things: (1) the connection stores its current position. After writing and reading “hello”, the next call to <code>readLines</code> does not read “hello” because the read position already passed “hello.” (2) <code>readLines</code> can be called directly on a path, and the funciton will handle the connection for you. Similar to the read position, we see the connection also stores the write position because “hello” was not overwritten by the second call to <code>writeLines</code>. The read and write positions can be queried using the <code>seek</code> function.</p>
<p>Please note: these functions are dangerous, because calling the wrong function can easily delete the file contents. You should be able to how to extract lines from a file, but mistakes are costly and using these functions would require you to parse the lines yourself. Luckily, R has many wrapper functions that manage the connections, reading, and parsing for you.</p>
</div>
<div id="importing-data-from-a-csv-file" class="section level3">
<h3 class="hasAnchor">
<a href="#importing-data-from-a-csv-file" class="anchor"></a>Importing data from a csv file</h3>
<p>A csv is a comma separated values file, which allows data to be saved in a table structured format. Excel files can often be saved as csv files. R has a function to read these files called <code>read.csv</code>. We will use this function to read in data from a csv file.</p>
<p>Consider the following file</p>
<pre><code># Here is a couple lines of comments explaining
# the file contents.
"id ","val  "
1,10
2,5
3,15
,</code></pre>
<p>We can create this file using what we learned above.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">csvFile</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span>(), <span class="st">"csvFile.csv"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/writeLines.html">writeLines</a></span>(<span class="kw">text</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"# Here is a couple lines of comments explaining"</span>,
                    <span class="st">"# the file contents."</span>,
                    <span class="st">"\"id \",\"val  \""</span>,
                    <span class="st">"1,10"</span>,
                    <span class="st">"2,5"</span>,
                    <span class="st">"3,15"</span>,
                    <span class="st">","</span>),
           <span class="kw">con</span> <span class="kw">=</span> <span class="no">csvFile</span>)</pre></body></html></div>
<p>Now we will use the <code>read.csv</code> function to read the data into a data.frame object.</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(<span class="no">csvFile</span>)
<span class="co">##                      X..Here.is.a.couple.lines.of.comments.explaining</span>
<span class="co">## # the file contents.                                                 </span>
<span class="co">## id                                                              val  </span>
<span class="co">## 1                                                                  10</span>
<span class="co">## 2                                                                   5</span>
<span class="co">## 3                                                                  15</span>
<span class="co">## </span></pre></body></html></div>
<p>The data is a mess due to the comment lines at the top of the file. We have three options: (1) edit the file by hand – a very poor choice, (2) skip those lines, or (3) tell the function how to look for comments. The following shows how to both skip and designate comments:</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(<span class="no">csvFile</span>, <span class="kw">skip</span> <span class="kw">=</span> <span class="fl">2</span>)
<span class="co">##   id. val..</span>
<span class="co">## 1   1    10</span>
<span class="co">## 2   2     5</span>
<span class="co">## 3   3    15</span>
<span class="co">## 4  NA    NA</span>
<span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(<span class="no">csvFile</span>, <span class="kw">comment.char</span> <span class="kw">=</span> <span class="st">"#"</span>)
<span class="co">##   id. val..</span>
<span class="co">## 1   1    10</span>
<span class="co">## 2   2     5</span>
<span class="co">## 3   3    15</span>
<span class="co">## 4  NA    NA</span></pre></body></html></div>
<p>However, we are not done. R does not like spaces in column names, and you can see the spaces have been replaced by periods. Additionally, you can see two rows of <code>NA</code> at the bottom of the table. To remove the spaces from the names we will introduce the regular expression functions.</p>
</div>
<div id="regular-expressions" class="section level3">
<h3 class="hasAnchor">
<a href="#regular-expressions" class="anchor"></a>Regular expressions</h3>
<p>Regular expressions are a way of finding text. They can be as simple as find any letter, or as complicated as find an explicit phrase, but only when it occurs after another phrase, and replace part of the first phrase with a third phrase. R has its own flavor of regular expressions (regex’s), but will also accept Perl regex. Here, we will look at a few cases using the <code>grep</code>, <code>grepl</code>, <code>sub</code>, and <code>gsub</code> functions.</p>
<p>First consider how to find regular expressions using the <code>grep</code> and <code>grepl</code> functions:</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">s1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"a"</span>, <span class="st">"ab"</span>, <span class="st">"b"</span>, <span class="st">"ac"</span>, <span class="st">"c"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span>(<span class="kw">pattern</span> <span class="kw">=</span> <span class="st">"a"</span>, <span class="kw">x</span> <span class="kw">=</span> <span class="no">s1</span>)
<span class="co">## [1] 1 2 4</span>
<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="kw">pattern</span> <span class="kw">=</span> <span class="st">"b"</span>, <span class="kw">x</span> <span class="kw">=</span> <span class="no">s1</span>)
<span class="co">## [1] FALSE  TRUE  TRUE FALSE FALSE</span></pre></body></html></div>
<p>We see <code>grep</code> returns the index of strings in the vector that contained the pattern, whereas <code>grepl</code> returns a vector indicating whether the pattern matched each string in the vector. <code>grep</code> will also return the strings that matched by indicating <code>value = TRUE</code>:</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span>(<span class="kw">pattern</span> <span class="kw">=</span> <span class="st">"c"</span>, <span class="kw">x</span> <span class="kw">=</span> <span class="no">s1</span>, <span class="kw">value</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="co">## [1] "ac" "c"</span></pre></body></html></div>
<p>The above examples have very simple patterns. <code><a href="https://rdrr.io/r/base/regex.html">?regex</a></code> gives a good starting point for how to make more general (“regular”!) patterns. For example, suppose we want to find every string of the format: capitalletter, lowercase letter. Here we can use <code>[:A-Z:]</code> to indicate any uppercase letter, and <code>[:A-Z:]</code> to indicate any lowercase letter.</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">s2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"ab"</span>, <span class="st">"Aba"</span>, <span class="st">"aBa"</span>, <span class="st">"Ab"</span>, <span class="st">"BB"</span>, <span class="st">"Ba"</span>, <span class="st">"Cb"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span>(<span class="st">"[:A-Z:][:a-z:]"</span>, <span class="no">s2</span>, <span class="kw">value</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="co">## [1] "Aba" "aBa" "Ab"  "Ba"  "Cb"</span></pre></body></html></div>
<p>This is close, but “Aba” breaks the desired format. It contains the format, but has too many letters. We can modify the regular expression with <code><a href="https://rdrr.io/r/base/Arithmetic.html">^</a></code> to indicate the start of the string and <code><a href="https://rdrr.io/r/base/Extract.html">$</a></code> to indicate the end of the string.</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span>(<span class="st">"^[:A-Z:][:a-z:]$"</span>, <span class="no">s2</span>, <span class="kw">value</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="co">## [1] "Ab" "Ba" "Cb"</span></pre></body></html></div>
<p>Now we get exactly the desired output. Again, <code><a href="https://rdrr.io/r/base/regex.html">?regex</a></code> provides a lot of information to get you started. It is (always!) helpful to read the documentation first. Now that we know how to find patterns, lets look at how to modify strings with the substitute functions.</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/grep.html">sub</a></span>(<span class="kw">pattern</span> <span class="kw">=</span> <span class="st">"Bob"</span>, <span class="kw">replacement</span> <span class="kw">=</span> <span class="st">"Tom"</span>, <span class="kw">x</span> <span class="kw">=</span> <span class="st">"Bob and Sally"</span>)
<span class="co">## [1] "Tom and Sally"</span></pre></body></html></div>
<p>Here we replace “Bob” with “Tom” in the string. What if “Bob” occurs twice in the string?</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/grep.html">sub</a></span>(<span class="kw">pattern</span> <span class="kw">=</span> <span class="st">"Bob"</span>, <span class="kw">replacement</span> <span class="kw">=</span> <span class="st">"Tom"</span>, <span class="kw">x</span> <span class="kw">=</span> <span class="st">"Bob, Bob, and Sally"</span>)
<span class="co">## [1] "Tom, Bob, and Sally"</span></pre></body></html></div>
<p>The <code>sub</code> function only finds the first instance of the pattern, then stops looking. If we want to replace all entries of the pattern we need the <code>gsub</code> function.</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(<span class="kw">pattern</span> <span class="kw">=</span> <span class="st">"Bob"</span>, <span class="kw">replacement</span> <span class="kw">=</span> <span class="st">"Tom"</span>, <span class="kw">x</span> <span class="kw">=</span> <span class="st">"Bob, Bob, and Sally"</span>)
<span class="co">## [1] "Tom, Tom, and Sally"</span></pre></body></html></div>
</div>
<div id="back-to-the-file-problems" class="section level3">
<h3 class="hasAnchor">
<a href="#back-to-the-file-problems" class="anchor"></a>Back to the file problems</h3>
<p>Now we can fix the column names. Recall we access the column names with the <code>colnames</code> function. First store the file to a data.frame called <code>dat</code>.</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="no">dat</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(<span class="no">csvFile</span>, <span class="kw">comment.char</span> <span class="kw">=</span> <span class="st">"#"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">dat</span>)
<span class="co">## [1] "id."   "val.."</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">dat</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(<span class="st">"[:.:]"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">dat</span>))
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">dat</span>)
<span class="co">## [1] "id"  "val"</span></pre></body></html></div>
<p>Now we just need to exclude the <code>NA</code> columns. There are MANY ways to do this. We will go over three. (1) If we know how many rows you should have you can read only those lines using the <code>nrows</code> parameter:</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(<span class="no">csvFile</span>, <span class="kw">comment.char</span> <span class="kw">=</span> <span class="st">"#"</span>, <span class="kw">nrows</span> <span class="kw">=</span> <span class="fl">3</span>)
<span class="co">##   id. val..</span>
<span class="co">## 1   1    10</span>
<span class="co">## 2   2     5</span>
<span class="co">## 3   3    15</span></pre></body></html></div>
<p>This is often not ideal, because we want to write generalized code when possible. What happens if we get an input file with a different number of rows? This approach would only work well if the input should always have exactly the same number of rows. (2) we can use the <code>na.omit</code> function. This is a powerful function, but, (depeding on your goals) you need to be careful about the input data structure. For a data.frame object, <code>na.omit</code> will remove rows with <code>NA</code> in ANY column. For example:</p>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span>(<span class="no">dat</span>)
<span class="co">##   id val</span>
<span class="co">## 1  1  10</span>
<span class="co">## 2  2   5</span>
<span class="co">## 3  3  15</span></pre></body></html></div>
<p>Consider if we had a slightly different data.frame, where we only wanted to remove <code>NA</code> values in the <code>id</code> column:</p>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="no">copyOfDat</span> <span class="kw">&lt;-</span> <span class="no">dat</span>
<span class="no">copyOfDat</span>[<span class="fl">5</span>, <span class="fl">1</span>] <span class="kw">&lt;-</span> <span class="fl">4</span>
<span class="no">copyOfDat</span>
<span class="co">##   id val</span>
<span class="co">## 1  1  10</span>
<span class="co">## 2  2   5</span>
<span class="co">## 3  3  15</span>
<span class="co">## 4 NA  NA</span>
<span class="co">## 5  4  NA</span>
<span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span>(<span class="no">copyOfDat</span>)
<span class="co">##   id val</span>
<span class="co">## 1  1  10</span>
<span class="co">## 2  2   5</span>
<span class="co">## 3  3  15</span></pre></body></html></div>
<p>In the above example, <code>na.omit</code> removed row 5 – this may not be the desired result. (3) we can find which rows have <code>NA</code> in them. This becomes tedious if we care about removing rows with any <code>NA</code> values, but if we only care about missing values in the <code>id</code> column, then this approach works best.</p>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="co"># First find the rows with valid ids</span>
<span class="no">keep</span> <span class="kw">&lt;-</span> !<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">copyOfDat</span>$<span class="no">id</span>)
<span class="no">copyOfDat</span>[<span class="no">keep</span>, ]
<span class="co">##   id val</span>
<span class="co">## 1  1  10</span>
<span class="co">## 2  2   5</span>
<span class="co">## 3  3  15</span>
<span class="co">## 5  4  NA</span></pre></body></html></div>
<p>Recall from our discussions about data structures and subsetting that we can subset using a logical vector. Supplying a logical vector to the <code>i</code> and <code>j</code> positions will only keep the rows or columns, respectivley, where the index is <code>TRUE</code>.</p>
</div>
<div id="more-details" class="section level3">
<h3 class="hasAnchor">
<a href="#more-details" class="anchor"></a>More details</h3>
<p>Not all data comes in as comma separated file – not to worry. The <code>read.csv</code> function is a specialized version of the <code>read.table</code> function. <code>read.table</code> reads arbitrary text files and can handle different separators (eg. tab-delimited .txt files) by specifying the <code>sep</code> argument. For example:</p>
<div class="sourceCode" id="cb25"><html><body><pre class="r"><span class="co"># Create a text string with our data -- this is just a shortcut rather</span>
<span class="co"># than writing out a file</span>
<span class="no">txt</span> <span class="kw">&lt;-</span> <span class="st">"1,2,3\n\"a\",\"4\",5"</span>
<span class="co"># cat interprets the text and prints it to the console -- here it recognizes</span>
<span class="co"># the special '\n' newline character</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="no">txt</span>)
<span class="co">## 1,2,3</span>
<span class="co">## "a","4",5</span>
<span class="co"># The read.table/read.csv functions can take a 'text' argument rather than </span>
<span class="co"># a path</span>
<span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(<span class="kw">text</span> <span class="kw">=</span> <span class="no">txt</span>)
<span class="co">##   X1 X2 X3</span>
<span class="co">## 1  a  4  5</span>
<span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span>(<span class="kw">text</span> <span class="kw">=</span> <span class="no">txt</span>, <span class="kw">sep</span> <span class="kw">=</span> <span class="st">","</span>)
<span class="co">##   V1 V2 V3</span>
<span class="co">## 1  1  2  3</span>
<span class="co">## 2  a  4  5</span></pre></body></html></div>
<p>We can see the two function calls are similar, but not identical. The issue here is with the “header.” R needs to know if the file contains a header, to be the column names, or not. By default, <code>read.table</code> does not expect a header and <code>read.csv</code> does. We can control this behavior with the <code>header</code> argument. <strong><em>This is an excellent example of why reading the documentation is important.</em></strong> Take a look at <code><a href="https://rdrr.io/r/utils/read.table.html">?read.table</a></code> – it will show the default <code>header</code> values for the two functions.</p>
<div class="sourceCode" id="cb26"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(<span class="kw">text</span> <span class="kw">=</span> <span class="no">txt</span>, <span class="kw">header</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="co">##   V1 V2 V3</span>
<span class="co">## 1  1  2  3</span>
<span class="co">## 2  a  4  5</span></pre></body></html></div>
<p>By default <code>read.table</code> expects a tab-delimited file, but any separator can be used. Consider the following examples:</p>
<div class="sourceCode" id="cb27"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span>(<span class="kw">text</span> <span class="kw">=</span> <span class="st">"a\tb\nb\ta"</span>)
<span class="co">##   V1 V2</span>
<span class="co">## 1  a  b</span>
<span class="co">## 2  b  a</span>
<span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span>(<span class="kw">text</span> <span class="kw">=</span> <span class="st">"a;b\nb;a"</span>)
<span class="co">##    V1</span>
<span class="co">## 1 a;b</span>
<span class="co">## 2 b;a</span>
<span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span>(<span class="kw">text</span> <span class="kw">=</span> <span class="st">"a;b\nb;a"</span>, <span class="kw">sep</span> <span class="kw">=</span> <span class="st">";"</span>)
<span class="co">##   V1 V2</span>
<span class="co">## 1  a  b</span>
<span class="co">## 2  b  a</span></pre></body></html></div>
<p>Notice the first column of <code>txt</code> has seemingly mixed data types; ie. column 1 contains a number and a letter. When loading data we need to pay close attention to data types. We will use the <code>str</code> function to keep track of data types for each column. First consider:</p>
<div class="sourceCode" id="cb28"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span>(<span class="kw">text</span> <span class="kw">=</span> <span class="no">txt</span>, <span class="kw">sep</span> <span class="kw">=</span> <span class="st">","</span>))
<span class="co">## 'data.frame':    2 obs. of  3 variables:</span>
<span class="co">##  $ V1: chr  "1" "a"</span>
<span class="co">##  $ V2: int  2 4</span>
<span class="co">##  $ V3: int  3 5</span></pre></body></html></div>
<p>We see the first column was actually imported as a factor. From the discussion on coercing data types, we may have expected the first column to import as a character. When data is loaded by <code>read.table</code> (or <code>read.csv</code>) each column is processed with the <code>type.convert</code> function. <code>type.convert</code> looks at the contents of the column, and chooses the lowest order data type possible. However, this function defaults to treating strings as factors. We can alter this behavior by passing <code>stringsAsFactors = FALSE</code> to <code>read.table</code> (this argument gets passed along to <code>type.convert</code>).</p>
<div class="sourceCode" id="cb29"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span>(<span class="kw">text</span> <span class="kw">=</span> <span class="no">txt</span>, <span class="kw">sep</span> <span class="kw">=</span> <span class="st">","</span>, <span class="kw">stringsAsFactors</span> <span class="kw">=</span> <span class="fl">FALSE</span>))
<span class="co">## 'data.frame':    2 obs. of  3 variables:</span>
<span class="co">##  $ V1: chr  "1" "a"</span>
<span class="co">##  $ V2: int  2 4</span>
<span class="co">##  $ V3: int  3 5</span></pre></body></html></div>
<p>Similarly, we can pass <code>as.is = TRUE</code>. The <code>as.is</code> paramter allows finer control. Like <code>stringsAsFactors</code> it accepts <code>TRUE/FALSE</code>, but it can also accept a vector of integers specifying which columns to leave “as.is” (meaning they are not converted to factors). For example:</p>
<div class="sourceCode" id="cb30"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span>(<span class="kw">text</span> <span class="kw">=</span> <span class="no">txt</span>, <span class="kw">sep</span> <span class="kw">=</span> <span class="st">","</span>, <span class="kw">as.is</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fl">3</span>))
<span class="co">## 'data.frame':    2 obs. of  3 variables:</span>
<span class="co">##  $ V1: chr  "1" "a"</span>
<span class="co">##  $ V2: int  2 4</span>
<span class="co">##  $ V3: int  3 5</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span>(<span class="kw">text</span> <span class="kw">=</span> <span class="no">txt</span>, <span class="kw">sep</span> <span class="kw">=</span> <span class="st">","</span>, <span class="kw">as.is</span> <span class="kw">=</span> <span class="fl">2</span>:<span class="fl">3</span>))
<span class="co">## 'data.frame':    2 obs. of  3 variables:</span>
<span class="co">##  $ V1: Factor w/ 2 levels "1","a": 1 2</span>
<span class="co">##  $ V2: int  2 4</span>
<span class="co">##  $ V3: int  3 5</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span>(<span class="kw">text</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">sub</a></span>(<span class="st">"4"</span>, <span class="st">"b"</span>, <span class="no">txt</span>), <span class="kw">sep</span> <span class="kw">=</span> <span class="st">","</span>, <span class="kw">as.is</span> <span class="kw">=</span> <span class="fl">2</span>:<span class="fl">3</span>))
<span class="co">## 'data.frame':    2 obs. of  3 variables:</span>
<span class="co">##  $ V1: Factor w/ 2 levels "1","a": 1 2</span>
<span class="co">##  $ V2: chr  "2" "b"</span>
<span class="co">##  $ V3: int  3 5</span></pre></body></html></div>
<p>Notice the 4 in <code>txt</code> is quoted, but R still recognizes <code>"4"</code> as coercible to numeric, and does so because the rest of the column is numeric. In the last example above we sub out the 4 for the letter “b”, but we only leave columns 2 and 3 “as is” resulting in a mix of factor and character columns in the result.</p>
</div>
<div id="saving-r-objects" class="section level3">
<h3 class="hasAnchor">
<a href="#saving-r-objects" class="anchor"></a>Saving R objects</h3>
<p>Suppose you do not want to bother with files, but want to save R objects directly. This can be especially helpful when you have complex data structures not easily represented by a flat file. Reading and writing R objects is also faster and takes less diskspace. R provides two modes to save objects. The first mode saves a single unnamed object (<code>saveRDS</code>/<code>readRDS</code>), and the second mode can save many named objects (<code>save</code>/<code>load</code>). We encourage you to read the documentation for these functions and experiment yourself.</p>
</div>
<div id="exercises" class="section level3">
<h3 class="hasAnchor">
<a href="#exercises" class="anchor"></a>Exercises</h3>
<p>These exercises are to help you solidify and expand on the information given above. We intentionally added some concepts that were not covered above, and hope that you will take a few minutes to think through what is happening and how R is interpreting the code.</p>
<ol style="list-style-type: decimal">
<li><p>What if the “a” value in <code>txt</code> was meant to indicate a missing value, and you actually want to <code>V1</code> to read in as numeric. Read the <code>type.convert</code> documentation and use what you learn to tell <code>read.table</code> that “a” means the value is missing.</p></li>
<li><p>Your collaborator from Europe sends you the following file: <code>"12,34\t15,01\t"</code>. Use <code>read.table</code> to correctly load the file with numeric values.</p></li>
<li>
<p>R does not provide a native solution for reading Excel files – wah, wah. Luckily, there are many packages available for doing so. We will discuss packages more later in the class. For now, simply run the following code which will install and load the <code>readxl</code> package.</p>
<pre><code><a href="https://rdrr.io/r/utils/install.packages.html"> install.packages("readxl")
 library(readxl)</a></code></pre>
<p>You will now have access to the <code>read_xls</code> function. You will use this function to load in some data, and then you will use what you’ve learned so far to create a cleaned object that you could use for further analysis.</p>
<pre><code> # First, download the file copied from the FBI database and take a look in Excel. 
 xlsLink &lt;- "https://raw.githubusercontent.com/How-to-Learn-to-Code/rclass/master/inst/other/crime.xls"
 download.file(xlsLink, "crime.xls")
 crime &lt;- read_xls("crime.xls")</code></pre>
<p>Don’t be intimidated by how the object looks. Running <code><a href="https://rdrr.io/r/base/class.html">class(crime)</a></code> shows that it is a new data structure that inherits from data.frame. You can treat it exactly like a data.frame, or coerce it back to a simple data.frame if you prefer (crime &lt;- as.data.frame(crime)). Now you need to use what you’ve learned so far to clean up the file, such that it matches the cleaned version we created. The cleaned version can be found here:</p>
<pre><code> csvLink &lt;- "https://raw.githubusercontent.com/How-to-Learn-to-Code/rclass/master/inst/other/crime.csv"
 cleanedDF &lt;- read.csv(csvLink)</code></pre>
</li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Dayne L Filer, Amy Pomeroy.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
